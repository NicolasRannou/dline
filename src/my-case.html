<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../bower_components/neon-animation/web-animations.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">

<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">


<link rel="import" href="my-icons.html">
<link rel="import" href="shared-styles.html">
<dom-module id="my-case">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      .content {
        display: flex;
        height: 100%;
        background-color: var(--dark-primary-color);
      }

      .answer {
        display:flex;
        flex-direction: column;
        width: 256px;
      }

      .viewers {
        display: flex;
        width: 100%;
        background-color: red;
      }

      paper-slider {
        width: 100%;
      }

      .main {
        width: 70%;
        background-color: green;
      }

      .small {
        width: 30%;
        background-color: yellow;
      }

      .small > div {
        height: 50%;
      }

    </style>

    <firebase-auth
      id="FBAuth"
      user="{{user}}">
    </firebase-auth>

    <firebase-query
      id="FBQuery"
      path="/cases"
      data="{{cases}}"
      equal-to="[[page]]">
    </firebase-query>

    <firebase-query
      id="FBSave"
      path="/users/[[user.uid]]/cases">
    </firebase-query>


<app-header-layout fullbleed>
  <app-header slot="header" fixed condenses effects="waterfall">
    <app-toolbar>
      <div main-title>[[userCase.id]]</div>
      <a name="view3" href="/home/"><paper-icon-button icon="my-icons:close"></paper-icon-button></a>
    </app-toolbar>
  </app-header>
  <div class="content">
      <div class="answer">
        <div>Best contour:</div>
        <paper-radio-group selected="{{contour}}">
          <paper-radio-button name="red">red</paper-radio-button>
          <paper-radio-button name="green">green</paper-radio-button>
          <paper-radio-button name="blue">blue</paper-radio-button>
          <paper-radio-button name="none">none</paper-radio-button>
        </paper-radio-group>
        <div>Choice was:</div>
        <paper-radio-group selected="{{choice}}">
          <paper-radio-button name="easy">easy</paper-radio-button>
          <paper-radio-button name="average">average</paper-radio-button>
          <paper-radio-button name="hard">hard</paper-radio-button>
          <paper-radio-button name="veryhard">very hard</paper-radio-button>
        </paper-radio-group>
        <div>I am a:</div>
        <paper-dropdown-menu label="Title" selected-item-label="{{title}}">
          <paper-listbox slot="dropdown-content" selected="{{titleIndex}}">
            <paper-item>Intern</paper-item>
            <paper-item>Medical Doctor (MD)</paper-item>
            <paper-item>Physicist</paper-item>
            <paper-item>Technician</paper-item>
            <paper-item>Other</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
        <paper-button
          on-tap="_submitAnswer"
          disabled$="[[_selectionDone(contour, choice, title)]]">
          Submit answer
        </paper-button>
      </div>
      <div class="viewers">
        <div class="main">
          <paper-slider></paper-slider>
        </div>
        <div class="small">
          <div><paper-slider></paper-slider></div>
          <div><paper-slider></paper-slider></div>
        </div>
      </div>
  </div>
</app-header-layout>

  </template>

  <script>
    class MyCase extends Polymer.Element {
      static get is() {
        return 'my-case';
      }

      static get properties() {
        return {
          routeData: {
            type: Object,
            value: {},
          },
          page: {
            type: String,
            reflectToAttribute: true,
            observer: '_pageChanged',
          },
          user: {
            type: Object,
            value: {},
          },
          cases: {
            type: Array,
          },
          userCase: {
            type: {},
          },
          contour: {
            type: String,
            value: '',
          },
          choice: {
            type: String,
            value: '',
          },
          title: {
            type: String,
            value: '',
          },
          titleIndex: {
            type: Number,
            value: -1,
          }
        };
      }

      static get observers() {
        return [
          '_routePageChanged(routeData.*)',
          '_casesChanged(cases.splices)',
        ];
      }

      _routePageChanged(routeData) {
        // Polymer 2.0 will call with `undefined` on initialization.
        // Ignore until we are properly called with a string.
        if (routeData === undefined) {
          return;
        }
        if (routeData.value.page !== 'case') {
          return;
        }
        this.page = routeData.value.subpage;
      }

      _pageChanged(page) {
        if (page === '') {
          return;
        }

        // fetch the data
        // images, models and
      }

      _casesChanged(cases) {
        if (cases === undefined) {
          return;
        }

        this.set('userCase', cases.indexSplices[0].object[0])
      }

      _submitAnswer() {
        // id
        // answers
        this.$.FBSave.ref.push({
          id: this.userCase.id,
          contour: this.contour,
          choice: this.choice,
          title: this.title,
        });

        this.contour = '';
        this.choice = '';
        this.title = '';
        this.titleIndex = -1;
      }

      _selectionDone(contour, choice, title) {
        console.log(contour);
        console.log(choice);
        console.log(title);
        return !(contour !== '' && choice !== '' && title !== '');
      }
    }

    window.customElements.define(MyCase.is, MyCase);
  </script>
</dom-module>
